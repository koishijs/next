<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.43">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/koishi.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#5546a3"><title>开发插件 | Koishi</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.7e6eba9e.js"><link rel="modulepreload" href="/assets/thirdeye.html.d2de1ab9.js"><link rel="modulepreload" href="/assets/thirdeye.html.82f54d84.js"><link rel="prefetch" href="/assets/index.html.fe50ba61.js"><link rel="prefetch" href="/assets/market.html.23407469.js"><link rel="prefetch" href="/assets/playground.html.3c65ec94.js"><link rel="prefetch" href="/assets/faq.html.2cb43d06.js"><link rel="prefetch" href="/assets/history.html.d1573efc.js"><link rel="prefetch" href="/assets/migration.html.83cd2f3b.js"><link rel="prefetch" href="/assets/glossary.html.e4708690.js"><link rel="prefetch" href="/assets/index.html.f7583275.js"><link rel="prefetch" href="/assets/index.html.cde755ed.js"><link rel="prefetch" href="/assets/index.html.a017cf38.js"><link rel="prefetch" href="/assets/introduction.html.7c38591a.js"><link rel="prefetch" href="/assets/index.html.df7158ce.js"><link rel="prefetch" href="/assets/docs.html.6521b622.js"><link rel="prefetch" href="/assets/structure.html.aaae4fd4.js"><link rel="prefetch" href="/assets/v4.1.html.fec991f2.js"><link rel="prefetch" href="/assets/v4.2.html.d566b6f8.js"><link rel="prefetch" href="/assets/v4.3.html.ae3c4cc3.js"><link rel="prefetch" href="/assets/v4.4.html.09a20977.js"><link rel="prefetch" href="/assets/v4.5.html.a42f44e2.js"><link rel="prefetch" href="/assets/v4.6.html.de5498ad.js"><link rel="prefetch" href="/assets/v4.7.html.1af084a1.js"><link rel="prefetch" href="/assets/client.html.c00676d3.js"><link rel="prefetch" href="/assets/server.html.2b4d0a48.js"><link rel="prefetch" href="/assets/adapter.html.b38b2dd8.js"><link rel="prefetch" href="/assets/app.html.18d94bd0.js"><link rel="prefetch" href="/assets/bot.html.b79a8d37.js"><link rel="prefetch" href="/assets/command.html.39b53e63.js"><link rel="prefetch" href="/assets/context.html.bcbcd0c7.js"><link rel="prefetch" href="/assets/events.html.0cca02d0.js"><link rel="prefetch" href="/assets/service.html.5e8592f6.js"><link rel="prefetch" href="/assets/session.html.a421c4c5.js"><link rel="prefetch" href="/assets/built-in.html.11bacd53.js"><link rel="prefetch" href="/assets/database.html.8e76aa30.js"><link rel="prefetch" href="/assets/evaluation.html.be5643bf.js"><link rel="prefetch" href="/assets/model.html.1dc39d52.js"><link rel="prefetch" href="/assets/query.html.0f1dbe77.js"><link rel="prefetch" href="/assets/logger.html.55b95375.js"><link rel="prefetch" href="/assets/misc.html.9ebad5e0.js"><link rel="prefetch" href="/assets/observer.html.7489ee9d.js"><link rel="prefetch" href="/assets/schema.html.84af82de.js"><link rel="prefetch" href="/assets/segment.html.aa706373.js"><link rel="prefetch" href="/assets/template.html.117b7367.js"><link rel="prefetch" href="/assets/nestjs.html.f6724b18.js"><link rel="prefetch" href="/assets/schemastery.html.e678dff6.js"><link rel="prefetch" href="/assets/binding.html.5dd44a3d.js"><link rel="prefetch" href="/assets/bot.html.1521a831.js"><link rel="prefetch" href="/assets/index.html.8171d2c8.js"><link rel="prefetch" href="/assets/writing.html.c8084c24.js"><link rel="prefetch" href="/assets/execution.html.7999013a.js"><link rel="prefetch" href="/assets/help.html.d9b8c405.js"><link rel="prefetch" href="/assets/index.html.6342989c.js"><link rel="prefetch" href="/assets/more.html.50755a2a.js"><link rel="prefetch" href="/assets/data.html.a8dda9ac.js"><link rel="prefetch" href="/assets/extension.html.d725eb9d.js"><link rel="prefetch" href="/assets/index.html.02579323.js"><link rel="prefetch" href="/assets/builtin.html.4cd68b51.js"><link rel="prefetch" href="/assets/index.html.85bab292.js"><link rel="prefetch" href="/assets/model.html.041b9026.js"><link rel="prefetch" href="/assets/observer.html.9bb3b27d.js"><link rel="prefetch" href="/assets/writing.html.2e122c24.js"><link rel="prefetch" href="/assets/crowdin.html.ad356243.js"><link rel="prefetch" href="/assets/index.html.179dde6f.js"><link rel="prefetch" href="/assets/presets.html.9f88668c.js"><link rel="prefetch" href="/assets/translation.html.531edacf.js"><link rel="prefetch" href="/assets/middleware.html.bab6a5a1.js"><link rel="prefetch" href="/assets/segment.html.8d7f2465.js"><link rel="prefetch" href="/assets/session.html.5b6ed756.js"><link rel="prefetch" href="/assets/unit-tests.html.1e43477a.js"><link rel="prefetch" href="/assets/context.html.d3f62317.js"><link rel="prefetch" href="/assets/index.html.0c5e68c8.js"><link rel="prefetch" href="/assets/lifecycle.html.d8f6118a.js"><link rel="prefetch" href="/assets/schema.html.bff54e4c.js"><link rel="prefetch" href="/assets/service.html.6687426c.js"><link rel="prefetch" href="/assets/assets.html.9198793b.js"><link rel="prefetch" href="/assets/http.html.a2d5024e.js"><link rel="prefetch" href="/assets/logger.html.ac268232.js"><link rel="prefetch" href="/assets/router.html.ef075ded.js"><link rel="prefetch" href="/assets/config.html.eda71152.js"><link rel="prefetch" href="/assets/development.html.48a95fde.js"><link rel="prefetch" href="/assets/direct.html.e582016f.js"><link rel="prefetch" href="/assets/docker.html.ecdda7de.js"><link rel="prefetch" href="/assets/server.html.d1d6c914.js"><link rel="prefetch" href="/assets/adapter.html.8baaa6a9.js"><link rel="prefetch" href="/assets/console.html.3a56e6bd.js"><link rel="prefetch" href="/assets/installation.html.e4af7ebf.js"><link rel="prefetch" href="/assets/next-step.html.0486bc23.js"><link rel="prefetch" href="/assets/node.html.05e1f460.js"><link rel="prefetch" href="/assets/admin.html.6137a861.js"><link rel="prefetch" href="/assets/bind.html.3fe5ac8f.js"><link rel="prefetch" href="/assets/callme.html.2bbc24d4.js"><link rel="prefetch" href="/assets/commands.html.487f1211.js"><link rel="prefetch" href="/assets/locales.html.1595edd0.js"><link rel="prefetch" href="/assets/rate-limit.html.efbe5380.js"><link rel="prefetch" href="/assets/schedule.html.11495405.js"><link rel="prefetch" href="/assets/sudo.html.316221c2.js"><link rel="prefetch" href="/assets/verifier.html.be0398a3.js"><link rel="prefetch" href="/assets/discord.html.ff009edc.js"><link rel="prefetch" href="/assets/kaiheila.html.623c902e.js"><link rel="prefetch" href="/assets/onebot.html.09d90202.js"><link rel="prefetch" href="/assets/qqguild.html.4f5e18a4.js"><link rel="prefetch" href="/assets/telegram.html.f0454c7f.js"><link rel="prefetch" href="/assets/events.html.49156a89.js"><link rel="prefetch" href="/assets/index.html.e25e1810.js"><link rel="prefetch" href="/assets/git.html.284b7372.js"><link rel="prefetch" href="/assets/local.html.2ff95a88.js"><link rel="prefetch" href="/assets/remote.html.0e18442b.js"><link rel="prefetch" href="/assets/s3.html.308cb6f8.js"><link rel="prefetch" href="/assets/broadcast.html.73f9f10c.js"><link rel="prefetch" href="/assets/echo.html.8ec11161.js"><link rel="prefetch" href="/assets/feedback.html.aa6561ce.js"><link rel="prefetch" href="/assets/forward.html.3135918e.js"><link rel="prefetch" href="/assets/recall.html.d69ee41e.js"><link rel="prefetch" href="/assets/repeater.html.248f0fd5.js"><link rel="prefetch" href="/assets/respondent.html.bf132de2.js"><link rel="prefetch" href="/assets/auth.html.851df632.js"><link rel="prefetch" href="/assets/chat.html.256d7af7.js"><link rel="prefetch" href="/assets/dataview.html.68891730.js"><link rel="prefetch" href="/assets/index.html.275ef0a6.js"><link rel="prefetch" href="/assets/insight.html.7ea099c2.js"><link rel="prefetch" href="/assets/logger.html.bb8d918c.js"><link rel="prefetch" href="/assets/manager.html.83d71f33.js"><link rel="prefetch" href="/assets/sandbox.html.e5a40de9.js"><link rel="prefetch" href="/assets/status.html.fbd43174.js"><link rel="prefetch" href="/assets/level.html.d0873314.js"><link rel="prefetch" href="/assets/memory.html.f540ad2f.js"><link rel="prefetch" href="/assets/mongo.html.892d82d4.js"><link rel="prefetch" href="/assets/mysql.html.e3dc6c66.js"><link rel="prefetch" href="/assets/sqlite.html.4a7d20e6.js"><link rel="prefetch" href="/assets/adventure.html.4df0d198.js"><link rel="prefetch" href="/assets/mock.html.f6156ae8.js"><link rel="prefetch" href="/assets/puppeteer.html.1815bd97.js"><link rel="prefetch" href="/assets/404.html.0f07aaf0.js"><link rel="prefetch" href="/assets/index.html.f6f62381.js"><link rel="prefetch" href="/assets/market.html.22d66df5.js"><link rel="prefetch" href="/assets/playground.html.09126e3f.js"><link rel="prefetch" href="/assets/faq.html.e4569e7d.js"><link rel="prefetch" href="/assets/history.html.e835139d.js"><link rel="prefetch" href="/assets/migration.html.a1a8bed3.js"><link rel="prefetch" href="/assets/glossary.html.a9d0aaac.js"><link rel="prefetch" href="/assets/index.html.1ec45e90.js"><link rel="prefetch" href="/assets/index.html.f8cc95d8.js"><link rel="prefetch" href="/assets/index.html.3554c904.js"><link rel="prefetch" href="/assets/introduction.html.4686d01d.js"><link rel="prefetch" href="/assets/index.html.318f9ca7.js"><link rel="prefetch" href="/assets/docs.html.15c54013.js"><link rel="prefetch" href="/assets/structure.html.fe68acc3.js"><link rel="prefetch" href="/assets/v4.1.html.18ae20d9.js"><link rel="prefetch" href="/assets/v4.2.html.ef2fcdc1.js"><link rel="prefetch" href="/assets/v4.3.html.571760c2.js"><link rel="prefetch" href="/assets/v4.4.html.35a0b9df.js"><link rel="prefetch" href="/assets/v4.5.html.be8e23f4.js"><link rel="prefetch" href="/assets/v4.6.html.17fe338a.js"><link rel="prefetch" href="/assets/v4.7.html.c5827b89.js"><link rel="prefetch" href="/assets/client.html.5bd8166a.js"><link rel="prefetch" href="/assets/server.html.66380477.js"><link rel="prefetch" href="/assets/adapter.html.c92e2c4d.js"><link rel="prefetch" href="/assets/app.html.5f5e7f92.js"><link rel="prefetch" href="/assets/bot.html.9d6789b3.js"><link rel="prefetch" href="/assets/command.html.580e62b7.js"><link rel="prefetch" href="/assets/context.html.a9b5c031.js"><link rel="prefetch" href="/assets/events.html.e6700252.js"><link rel="prefetch" href="/assets/service.html.e1c6d6f2.js"><link rel="prefetch" href="/assets/session.html.e34235fa.js"><link rel="prefetch" href="/assets/built-in.html.d2e276ba.js"><link rel="prefetch" href="/assets/database.html.a56f98a2.js"><link rel="prefetch" href="/assets/evaluation.html.b9790f9d.js"><link rel="prefetch" href="/assets/model.html.a587e5eb.js"><link rel="prefetch" href="/assets/query.html.fe2f87b1.js"><link rel="prefetch" href="/assets/logger.html.f02d305a.js"><link rel="prefetch" href="/assets/misc.html.43b8984b.js"><link rel="prefetch" href="/assets/observer.html.523a4dd7.js"><link rel="prefetch" href="/assets/schema.html.7c97e2c1.js"><link rel="prefetch" href="/assets/segment.html.42243078.js"><link rel="prefetch" href="/assets/template.html.92279832.js"><link rel="prefetch" href="/assets/nestjs.html.c0c76ca1.js"><link rel="prefetch" href="/assets/schemastery.html.9ab6a654.js"><link rel="prefetch" href="/assets/binding.html.16e5940f.js"><link rel="prefetch" href="/assets/bot.html.60fc2f45.js"><link rel="prefetch" href="/assets/index.html.c70b6012.js"><link rel="prefetch" href="/assets/writing.html.ea93f55e.js"><link rel="prefetch" href="/assets/execution.html.1ef6911e.js"><link rel="prefetch" href="/assets/help.html.f53f3012.js"><link rel="prefetch" href="/assets/index.html.5afed54a.js"><link rel="prefetch" href="/assets/more.html.24a6b9d0.js"><link rel="prefetch" href="/assets/data.html.f26491f8.js"><link rel="prefetch" href="/assets/extension.html.a5ccb717.js"><link rel="prefetch" href="/assets/index.html.97ccbb67.js"><link rel="prefetch" href="/assets/builtin.html.05f40295.js"><link rel="prefetch" href="/assets/index.html.c39ccedf.js"><link rel="prefetch" href="/assets/model.html.c3ad0f63.js"><link rel="prefetch" href="/assets/observer.html.c1d86708.js"><link rel="prefetch" href="/assets/writing.html.a5368a69.js"><link rel="prefetch" href="/assets/crowdin.html.3c75ea9d.js"><link rel="prefetch" href="/assets/index.html.9e6a27b0.js"><link rel="prefetch" href="/assets/presets.html.94001a37.js"><link rel="prefetch" href="/assets/translation.html.318d89d0.js"><link rel="prefetch" href="/assets/middleware.html.a857f2f9.js"><link rel="prefetch" href="/assets/segment.html.da903900.js"><link rel="prefetch" href="/assets/session.html.afdf6fed.js"><link rel="prefetch" href="/assets/unit-tests.html.f444cddc.js"><link rel="prefetch" href="/assets/context.html.8a832085.js"><link rel="prefetch" href="/assets/index.html.7b85d33f.js"><link rel="prefetch" href="/assets/lifecycle.html.6ff994de.js"><link rel="prefetch" href="/assets/schema.html.67d70a1f.js"><link rel="prefetch" href="/assets/service.html.ac626b36.js"><link rel="prefetch" href="/assets/assets.html.ea8230b7.js"><link rel="prefetch" href="/assets/http.html.e8df61c0.js"><link rel="prefetch" href="/assets/logger.html.7cde1367.js"><link rel="prefetch" href="/assets/router.html.09576d99.js"><link rel="prefetch" href="/assets/config.html.3d03fbad.js"><link rel="prefetch" href="/assets/development.html.2f9ed534.js"><link rel="prefetch" href="/assets/direct.html.ca95b2c9.js"><link rel="prefetch" href="/assets/docker.html.f9dc1161.js"><link rel="prefetch" href="/assets/server.html.f73c7392.js"><link rel="prefetch" href="/assets/adapter.html.f7f88550.js"><link rel="prefetch" href="/assets/console.html.be8d99de.js"><link rel="prefetch" href="/assets/installation.html.a16f1745.js"><link rel="prefetch" href="/assets/next-step.html.8f52ce82.js"><link rel="prefetch" href="/assets/node.html.55200ebf.js"><link rel="prefetch" href="/assets/admin.html.8cb8fd16.js"><link rel="prefetch" href="/assets/bind.html.b0479c3d.js"><link rel="prefetch" href="/assets/callme.html.fa04f619.js"><link rel="prefetch" href="/assets/commands.html.5313e118.js"><link rel="prefetch" href="/assets/locales.html.2a79dc81.js"><link rel="prefetch" href="/assets/rate-limit.html.2bb9454d.js"><link rel="prefetch" href="/assets/schedule.html.a66d9c27.js"><link rel="prefetch" href="/assets/sudo.html.2e98b9ab.js"><link rel="prefetch" href="/assets/verifier.html.79411cd6.js"><link rel="prefetch" href="/assets/discord.html.942fe07b.js"><link rel="prefetch" href="/assets/kaiheila.html.bff56d90.js"><link rel="prefetch" href="/assets/onebot.html.0ba20037.js"><link rel="prefetch" href="/assets/qqguild.html.69d14a8a.js"><link rel="prefetch" href="/assets/telegram.html.e525ecae.js"><link rel="prefetch" href="/assets/events.html.66772533.js"><link rel="prefetch" href="/assets/index.html.2853f7a3.js"><link rel="prefetch" href="/assets/git.html.836755bf.js"><link rel="prefetch" href="/assets/local.html.31b90e6d.js"><link rel="prefetch" href="/assets/remote.html.49b0233a.js"><link rel="prefetch" href="/assets/s3.html.2451fd7b.js"><link rel="prefetch" href="/assets/broadcast.html.f19efc9b.js"><link rel="prefetch" href="/assets/echo.html.0ac64d02.js"><link rel="prefetch" href="/assets/feedback.html.1ee66d4d.js"><link rel="prefetch" href="/assets/forward.html.15bd3f6c.js"><link rel="prefetch" href="/assets/recall.html.da74e2c9.js"><link rel="prefetch" href="/assets/repeater.html.6217674c.js"><link rel="prefetch" href="/assets/respondent.html.cd59a7d1.js"><link rel="prefetch" href="/assets/auth.html.3338963d.js"><link rel="prefetch" href="/assets/chat.html.e0f7526a.js"><link rel="prefetch" href="/assets/dataview.html.a59cd08e.js"><link rel="prefetch" href="/assets/index.html.49e37a06.js"><link rel="prefetch" href="/assets/insight.html.508e9e8f.js"><link rel="prefetch" href="/assets/logger.html.6d1214ae.js"><link rel="prefetch" href="/assets/manager.html.b9d856c5.js"><link rel="prefetch" href="/assets/sandbox.html.1b4d27fb.js"><link rel="prefetch" href="/assets/status.html.654164aa.js"><link rel="prefetch" href="/assets/level.html.dfba4d98.js"><link rel="prefetch" href="/assets/memory.html.69174b85.js"><link rel="prefetch" href="/assets/mongo.html.14d6852d.js"><link rel="prefetch" href="/assets/mysql.html.540eab35.js"><link rel="prefetch" href="/assets/sqlite.html.8918d796.js"><link rel="prefetch" href="/assets/adventure.html.a29b755b.js"><link rel="prefetch" href="/assets/mock.html.3db773db.js"><link rel="prefetch" href="/assets/puppeteer.html.625b602b.js"><link rel="prefetch" href="/assets/404.html.d88a84d4.js"><link rel="prefetch" href="/assets/404.8f69d6b2.js"><link rel="prefetch" href="/assets/Layout.c8b1e828.js"><link rel="prefetch" href="/assets/index.71cda615.js">
    <link rel="stylesheet" href="/assets/style.09b8f917.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/koishi.png" alt="Koishi"><span class="site-name can-hide">Koishi</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v4.x (10a1af9)"><span class="title">v4.x (10a1af9)</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v4.x (10a1af9)"><span class="title">v4.x (10a1af9)</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v3/" rel="noopener noreferrer" target="_blank" aria-label="v3.x"><!--[--><!--]--> v3.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v1/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/manual/introduction.md" class="" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生态"><span class="title">生态</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生态"><span class="title">生态</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/market.html" class="" aria-label="插件市场"><!--[--><!--]--> 插件市场 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/plugins/" class="" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/community/" class="router-link-active" aria-label="社区生态"><!--[--><!--]--> 社区生态 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/about/faq.md" class="" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--[--><div class="navbar-icons"><a class="icon" href="https://discord.com/invite/xfxYwmd284" target="_blank" aria-label="Discord"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 640 576"><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z" fill="currentColor"></path></svg></a><a class="icon" href="https://jq.qq.com/?_wv=1027&amp;k=6FDoxQ6g" target="_blank" aria-label="QQ"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="-96 0 640 576"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z" fill="currentColor"></path></svg></a><a class="icon" href="https://github.com/koishijs/koishi" target="_blank" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 2C6.475 2 2 6.475 2 12a9.994 9.994 0 0 0 6.838 9.488c.5.087.687-.213.687-.476c0-.237-.013-1.024-.013-1.862c-2.512.463-3.162-.612-3.362-1.175c-.113-.288-.6-1.175-1.025-1.413c-.35-.187-.85-.65-.013-.662c.788-.013 1.35.725 1.538 1.025c.9 1.512 2.338 1.087 2.912.825c.088-.65.35-1.087.638-1.337c-2.225-.25-4.55-1.113-4.55-4.938c0-1.088.387-1.987 1.025-2.688c-.1-.25-.45-1.275.1-2.65c0 0 .837-.262 2.75 1.026a9.28 9.28 0 0 1 2.5-.338c.85 0 1.7.112 2.5.337c1.912-1.3 2.75-1.024 2.75-1.024c.55 1.375.2 2.4.1 2.65c.637.7 1.025 1.587 1.025 2.687c0 3.838-2.337 4.688-4.562 4.938c.362.312.675.912.675 1.85c0 1.337-.013 2.412-.013 2.75c0 .262.188.574.688.474A10.016 10.016 0 0 0 22 12c0-5.525-4.475-10-10-10z" fill="currentColor"></path></svg></a><a class="icon"><svg style="display:none;" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.662 17.854 17.316 22 12.001 22C6.477 22 2 17.523 2 12c0-5.315 4.146-9.661 9.38-9.981z" fill="currentColor"></path></svg><svg style="" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z" fill="currentColor"></path></svg></a></div><!--]--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v4.x (10a1af9)"><span class="title">v4.x (10a1af9)</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v4.x (10a1af9)"><span class="title">v4.x (10a1af9)</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v3/" rel="noopener noreferrer" target="_blank" aria-label="v3.x"><!--[--><!--]--> v3.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://koishi.js.org/v1/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/manual/introduction.md" class="" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生态"><span class="title">生态</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生态"><span class="title">生态</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/market.html" class="" aria-label="插件市场"><!--[--><!--]--> 插件市场 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/plugins/" class="" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/community/" class="router-link-active" aria-label="社区生态"><!--[--><!--]--> 社区生态 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/about/faq.md" class="" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/community/" class="router-link-active sidebar-item sidebar-heading" aria-label="总览"><!--[--><!--]--> 总览 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">装饰器支持 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="开发插件"><!--[--><!--]--> 开发插件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#定义插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义插件"><!--[--><!--]--> 定义插件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#插件基类" class="router-link-active router-link-exact-active sidebar-item" aria-label="插件基类"><!--[--><!--]--> 插件基类 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#属性注入" class="router-link-active router-link-exact-active sidebar-item" aria-label="属性注入"><!--[--><!--]--> 属性注入 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#api" class="router-link-active router-link-exact-active sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#钩子方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="钩子方法"><!--[--><!--]--> 钩子方法 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#api-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#注册事件" class="router-link-active router-link-exact-active sidebar-item" aria-label="注册事件"><!--[--><!--]--> 注册事件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#注册装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="注册装饰器"><!--[--><!--]--> 注册装饰器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#指令描述" class="router-link-active router-link-exact-active sidebar-item" aria-label="指令描述"><!--[--><!--]--> 指令描述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#指令参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="指令参数"><!--[--><!--]--> 指令参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#子指令" class="router-link-active router-link-exact-active sidebar-item" aria-label="子指令"><!--[--><!--]--> 子指令 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#多语言与模板渲染" class="router-link-active router-link-exact-active sidebar-item" aria-label="多语言与模板渲染"><!--[--><!--]--> 多语言与模板渲染 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#注入渲染器" class="router-link-active router-link-exact-active sidebar-item" aria-label="注入渲染器"><!--[--><!--]--> 注入渲染器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#文本定义" class="router-link-active router-link-exact-active sidebar-item" aria-label="文本定义"><!--[--><!--]--> 文本定义 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#嵌套插件与异步插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="嵌套插件与异步插件"><!--[--><!--]--> 嵌套插件与异步插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#选择器" class="router-link-active router-link-exact-active sidebar-item" aria-label="选择器"><!--[--><!--]--> 选择器 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#api-4" class="router-link-active router-link-exact-active sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#条件注册" class="router-link-active router-link-exact-active sidebar-item" aria-label="条件注册"><!--[--><!--]--> 条件注册 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#api-5" class="router-link-active router-link-exact-active sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#声明依赖关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="声明依赖关系"><!--[--><!--]--> 声明依赖关系 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#全局依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="全局依赖"><!--[--><!--]--> 全局依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#部分依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="部分依赖"><!--[--><!--]--> 部分依赖 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#提供服务" class="router-link-active router-link-exact-active sidebar-item" aria-label="提供服务"><!--[--><!--]--> 提供服务 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#caller-装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="@Caller 装饰器"><!--[--><!--]--> @Caller 装饰器 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#多实例插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="多实例插件"><!--[--><!--]--> 多实例插件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#编写切面" class="router-link-active router-link-exact-active sidebar-item" aria-label="编写切面"><!--[--><!--]--> 编写切面 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#定义多实例插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义多实例插件"><!--[--><!--]--> 定义多实例插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#实例管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="实例管理"><!--[--><!--]--> 实例管理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#扩展数据表" class="router-link-active router-link-exact-active sidebar-item" aria-label="扩展数据表"><!--[--><!--]--> 扩展数据表 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/community/decorator/thirdeye.html#定义数据表" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义数据表"><!--[--><!--]--> 定义数据表 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#注册数据表模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="注册数据表模型"><!--[--><!--]--> 注册数据表模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/community/decorator/thirdeye.html#扩展内置数据表" class="router-link-active router-link-exact-active sidebar-item" aria-label="扩展内置数据表"><!--[--><!--]--> 扩展内置数据表 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/community/decorator/schemastery.html" class="sidebar-item" aria-label="描述配置模式"><!--[--><!--]--> 描述配置模式 <!--[--><!--]--></a><!----></li><li><a href="/community/decorator/nestjs.html" class="sidebar-item" aria-label="NestJS 开发"><!--[--><!--]--> NestJS 开发 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="开发插件" tabindex="-1"><a class="header-anchor" href="#开发插件" aria-hidden="true">#</a> 开发插件</h1><p><a href="https://github.com/koishijs/koishi-thirdeye" target="_blank" rel="noopener noreferrer">koishi-thirdeye<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 允许您使用类装饰器开发 Koishi 插件。下面是一个一目了然的例子：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  DefinePlugin,</span></span>
<span class="line"><span style="color:#F8F8F2;">  SchemaProperty,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutOption,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseCommand,</span></span>
<span class="line"><span style="color:#F8F8F2;">  OnApply,</span></span>
<span class="line"><span style="color:#F8F8F2;">  KoaContext,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseMiddleware,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseEvent,</span></span>
<span class="line"><span style="color:#F8F8F2;">  Get,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutUserName,</span></span>
<span class="line"><span style="color:#F8F8F2;">  CommandUsage,</span></span>
<span class="line"><span style="color:#F8F8F2;">} </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Context, Session } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { WebSocket } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ws&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { IncomingMessage } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;http&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该方法会在插件加载时调用，用于在上下文中注册事件等操作。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册中间件</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseMiddleware</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">simpleMiddleware</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">next</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">NextFunction</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">next</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册事件监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> session.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pong&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。}`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 Koa 路由</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/ping&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">koaCtx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">KoaContext</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    koaCtx.body </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 WebSocket 监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Ws</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/my-ws&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onWsClientConnect</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WebSocket</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">IncomingMessage</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">write</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;Hello!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">close</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="定义插件" tabindex="-1"><a class="header-anchor" href="#定义插件" aria-hidden="true">#</a> 定义插件</h2><p>koishi-thirdeye 允许您使用 <code>@DefinePlugin()</code> 装饰器定义类插件。您可以向装饰器中传入插件的基本信息：</p><ul><li><strong>name:</strong> <code>string</code> 插件名称。</li><li><strong>schema:</strong> <code>Schema</code> 插件的描述配置模式。既可以是传统的 Schema 描述模式，也可以是由 <a href="/community/decorator/schemastery.html" class="">schemastery-gen</a> 生成的 Schema 类。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { DefineSchema, SchemaProperty, DefinePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Partial</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt;) {} </span><span style="color:#88846F;">// 不建议在构造函数进行任何操作</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>koishi-thirdeye 已经重新导出了 schemastery-gen 这个包。您无需重新安装或导入 schemastery-gen 包。</p></div><h3 id="插件基类" tabindex="-1"><a class="header-anchor" href="#插件基类" aria-hidden="true">#</a> 插件基类</h3><p>为了简化插件的编写，插件基类 <code>BasePlugin&lt;Config&gt;</code> 实现了上面的构造函数定义，并定义了一些常用属性。因此上面的代码可以简化为：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { DefineSchema, SchemaProperty, DefinePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>在插件内分别可以使用 <code>this.config</code> 和 <code>this.ctx</code> 访问配置和上下文对象。</p><h2 id="属性注入" tabindex="-1"><a class="header-anchor" href="#属性注入" aria-hidden="true">#</a> 属性注入</h2><p>您可以在类成员变量中，使用装饰器进行注入成员变量。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>注入的变量在构造函数中无法访问。您只能在 <code>onApply</code> 等生命周期钩子函数中调用。</p></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Partial</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt;) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 建议如此使用 Context，而不是构造函数中的</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectContext</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 建议如此使用 Config，而不是构造函数中的</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectConfig</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// Logger 名称默认为插件名称</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">InjectLogger</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> logger</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Logger</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注入 Service API 中的 Assets，并声明为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;assets&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> assets</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Assets</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 根据属性名称判别 Service API 名称</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> API</h3><ul><li><code>@InjectContext(select?: Selection)</code> 注入上下文对象。<strong>注入的上下文对象会受全局选择器影响</strong>。</li><li><code>@InjectApp()</code> 注入 Koishi 实例对象。</li><li><code>@InjectConfig()</code> 注入插件配置。</li><li><code>@InjectLogger(name: string)</code> 注入 Koishi 日志记录器。</li><li><code>@Inject(name?: string, addUsing?: boolean)</code> 在插件类某一属性注入特定上下文 Service。<code>name</code> 若为空则默认为类方法名。 <ul><li><code>addUsing</code> 若为 <code>true</code> 则会将该服务声明为本插件的依赖。</li></ul></li></ul><h2 id="钩子方法" tabindex="-1"><a class="header-anchor" href="#钩子方法" aria-hidden="true">#</a> 钩子方法</h2><p>钩子方法会在特定的时机被调用。要使用钩子方法，只需要实现 <code>LifecycleEvents</code> 接口，并定义相应的方法即可。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 下列方法只实现需要使用的</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onConnect</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onDisconnect</span><span style="color:#F8F8F2;">() {}</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api-1" tabindex="-1"><a class="header-anchor" href="#api-1" aria-hidden="true">#</a> API</h3><ul><li><strong>onApply:</strong> 只能是同步函数，会在插件加载时运行</li><li><strong>onConnect:</strong> 可以是异步函数，会在 Koishi 启动时运行，相当于 ready 事件的回调函数</li><li><strong>onDisconnect:</strong> 可以是异步函数，会在插件被卸载时运行，相当于 dispose 事件的回调函数</li></ul><h2 id="注册事件" tabindex="-1"><a class="header-anchor" href="#注册事件" aria-hidden="true">#</a> 注册事件</h2><p>正如最开始的例子一样，我们可以使用以 <code>Use</code> 开头的装饰器进行事件和中间件的注册监听。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  DefinePlugin,</span></span>
<span class="line"><span style="color:#F8F8F2;">  SchemaProperty,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutOption,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseCommand,</span></span>
<span class="line"><span style="color:#F8F8F2;">  OnApply,</span></span>
<span class="line"><span style="color:#F8F8F2;">  KoaContext,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseMiddleware,</span></span>
<span class="line"><span style="color:#F8F8F2;">  UseEvent,</span></span>
<span class="line"><span style="color:#F8F8F2;">  Get,</span></span>
<span class="line"><span style="color:#F8F8F2;">  PutUserName,</span></span>
<span class="line"><span style="color:#F8F8F2;">  CommandUsage,</span></span>
<span class="line"><span style="color:#F8F8F2;">} </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Context, Session } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { WebSocket } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ws&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { IncomingMessage } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;http&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ default: </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  foo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#F92672;">implements</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LifecycleEvents</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该方法会在插件加载时调用，用于在上下文中注册事件等操作。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册中间件</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseMiddleware</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">simpleMiddleware</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">next</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">NextFunction</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">next</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册事件监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (session.content </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> session.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pong&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;今天穿裙子了吗？&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color:string&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿的裙子的颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 Koa 路由</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/ping&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">koaCtx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">KoaContext</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    koaCtx.body </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册 WebSocket 监听器</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Ws</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/my-ws&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onWsClientConnect</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WebSocket</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">IncomingMessage</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">write</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;Hello!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    socket.</span><span style="color:#A6E22E;">close</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="注册装饰器" tabindex="-1"><a class="header-anchor" href="#注册装饰器" aria-hidden="true">#</a> 注册装饰器</h3><ul><li><code>@UseMiddleware(prepend?: boolean)</code> 注册中间件。等价于 <code>ctx.middleware(callback, prepend)</code>。</li><li><code>@UseEvent(name: EventName, prepend?: boolean)</code> 注册事件监听器。等价于 <code>ctx.on(name, callback, prepend)</code>。</li><li><code>@UseBeforeEvent(name: BeforeEventName, prepend?: boolean)</code> 注册事件监听器。等价于 <code>ctx.before(name, callback, prepend)</code>。</li><li><code>@UseCommand(def: string, desc?: string, config?: Command.Config)</code> 注册指令。 <ul><li>若指定 <code>config.empty</code> 则不会注册当前函数为 action，用于没有 action 的父指令。</li></ul></li><li><code>@UseInterval(ms: number)</code> 注册定时任务，等价于 <code>ctx.setInterval(callback, ms)</code>。</li><li><code>@Get(path: string)</code> <code>@Post(path: string)</code> 在 Koishi 的 Koa 路由中注册 GET/POST 路径。此外， PUT PATCH DELETE 等方法也有所支持。</li><li><code>@Ws(path: string)</code> 注册 Koishi 的 WebSocket 监听器。</li></ul><h3 id="指令描述" tabindex="-1"><a class="header-anchor" href="#指令描述" aria-hidden="true">#</a> 指令描述</h3><p>koishi-thirdeye 使用一组装饰器进行描述指令的行为。这些装饰器需要和 <code>@UseCommand()</code> 装饰器一起使用。</p><p>特别地，可以把这些装饰器定义在插件顶部，使得该类插件中所有指令均应用这一指令描述。</p><p>我们来看一个例子。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;乒乓球真好玩！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 会适用于 ping 和 pang 两个指令</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ping&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;Ping!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandShortcut</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;枰！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只适用于 ping 指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPing</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;pong&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;pang&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;Pang!&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandShortcut</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;乓！&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只适用于 pang 指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onPang</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;peng&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="api-2" tabindex="-1"><a class="header-anchor" href="#api-2" aria-hidden="true">#</a> API</h4><ul><li><code>@CommandDescription(text: string)</code> 指令描述。等价于 <code>ctx.command(def, desc)</code> 中的描述。</li><li><code>@CommandUsage(text: string)</code> 指令介绍。等价于 <code>cmd.usage(text)</code>。</li><li><code>@CommandExample(text: string)</code> 指令示例。等价于 <code>cmd.example(text)</code>。</li><li><code>@CommandAlias(def: string)</code> 指令别名。等价于 <code>cmd.alias(def)</code>。</li><li><code>@CommandShortcut(def: string, config?: Command.Shortcut)</code> 指令快捷方式。等价于 <code>cmd.shortcut(def, config)</code>。</li><li><code>@CommandBefore(callback: Command.Action, append = false)</code> 等价于 <code>cmd.before(callback, append)</code>。</li><li><code>@CommandAction(callback: Command.Action, prepend = false)</code> 等价于 <code>cmd.action(callback, append)</code>。</li><li><code>@CommandUse(callback, ...args)</code> 指令功能配置。等价于 <code>cmd.use(callback, ...args)</code>。</li><li><code>@CommandLocale(locale: string, def: any)</code> 注册该指令特定语言的 i18n 模板。等价于 <code>ctx.i18n.define(locale, &#39;commands.{指令名称}&#39;, def)</code>。</li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>装饰器的执行顺序为由下到上。<code>@CommandBefore</code> 会从上到下执行，而 <code>@CommandAction</code> 会从下到上执行。而作为类成员方法的回调函数会<strong>最后</strong>执行。</p></div><h3 id="指令参数" tabindex="-1"><a class="header-anchor" href="#指令参数" aria-hidden="true">#</a> 指令参数</h3><p>指令参数也使用一组方法参数装饰器对由 <code>@UseCommand</code> 定义的类成员方法参数进行注入。此外，部分参数装饰器可以改变指令的行为。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注册指令</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">count</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 注入该指令的第 1 个参数，并标记该指令的第 1 个参数是 number 类型。</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color&gt;  裙子的颜色&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 为该方法添加 color 选项，注入到该参数内。</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">, </span><span style="color:#88846F;">// 注入调用指令的用户的名称。</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条裙子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>您或许可以注意到，<code>color</code> 选项并没有使用 <code>&lt;color:string&gt;</code> 这种显式指定选项类型的语法进行定义。但是 koishi-thirdeye 会由 <code>onDressCommand</code> 方法参数 <code>color</code> 的类型进行推断出 <code>string</code> 类型，并写入 <code>dress</code> 指令。类似地，<code>dress</code> 命令的第一个参数 <code>[count:number]</code> 也是自动推断生成的。因此，使用 koishi-thirdeye 编写指令的时候，无需刻意手动指定类型，大部分情况下类型会被自动推断。</p><h4 id="类参数" tabindex="-1"><a class="header-anchor" href="#类参数" aria-hidden="true">#</a> 类参数</h4><p>在属性比较多或多个指令的参数存在大量重复的情况下，使用过多方法参数装饰器可能不太优雅。这种情况下您也可以使用类定义指令参数。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  count</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;color&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-c &lt;color&gt;  颜色&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PutUserName</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿裙子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onDressCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutObject</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">arg</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条裙子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sock&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;穿袜子&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onSockCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutObject</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">arg</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">WearArg</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 今天穿了 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.count </span><span style="color:#F92672;">||</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> 条袜子，颜色是 </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">arg.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">。`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="api-3" tabindex="-1"><a class="header-anchor" href="#api-3" aria-hidden="true">#</a> API</h4><p>这些装饰器可以用于指令对应的类成员方法参数，也可以用于注入类的方法。</p><ul><li><code>@PutArgv(field?: keyof Argv)</code> 注入 <code>Argv</code> 对象，或 <code>Argv</code> 对象的指定字段。</li><li><code>@PutSession(field?: keyof Session)</code> 注入 <code>Session</code> 对象，或 <code>Session</code> 对象的指定字段。</li><li><code>@PutArg(index: number)</code> 注入指令的第 n 个参数，从 0 开始。</li><li><code>@PutArgs()</code> 注入包含指令全部参数的数组。</li><li><code>@PutOption(name: string, desc: string, config: Argv.OptionConfig = {})</code> 给指令添加选项并注入到该参数。等价于 <code>cmd.option(name, desc, config)</code>。</li><li><code>@PutUser(fields: string[])</code> 添加一部分字段用于观测，并将 User 对象注入到该参数。</li><li><code>@PutChannel(fields: string[])</code> 添加一部分字段用于观测，并将 Channel 对象注入到该参数。</li><li><code>@PutGuild(fields: string[])</code> 添加一部分字段用于观测，并将 Guild 对象注入到该参数。</li><li><code>@PutUserName(useDatabase: boolean = true)</code> 注入当前用户的用户名。 <ul><li><code>useDatabase</code> 是否尝试从数据库获取用户名。<strong>会自动把 <code>name</code> 加入用户观察者属性中</strong>。</li></ul></li><li><code>@PutNext()</code> 注入 <code>argv.next</code> 方法。</li><li><code>@PutRenderer(path: string)</code> 注入某一特定 i18n 路径的渲染器，类型为 <code>Renderer&lt;T&gt;</code>。</li><li><code>@PutCommonRenderer()</code> 注入通用渲染器，类型为 <code>CRenderer</code>。</li><li><code>@PutObject()</code> 注入类定义的对象。</li></ul><h3 id="子指令" tabindex="-1"><a class="header-anchor" href="#子指令" aria-hidden="true">#</a> 子指令</h3><p>koishi-thirdeye 中，子指令需要用完整的名称进行声明。</p><ul><li>对于没有回调的父指令，可以使用 <code>empty</code> 选项，使其不具有 action 字段。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 相关指令&#39;</span><span style="color:#F8F8F2;">, { empty: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproCommand</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 该指令不会有 action，因此该方法不会被调用。</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro.rank&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 排名&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;查询玩家的 YGOPro 排名&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproRankCommand</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-p &lt;name:string&gt;  玩家名称&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;ygopro.rooms&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;YGOPro 房间&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandUsage</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;查询 YGOPro 房间列表&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">ygoproRoomsCommand</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="多语言与模板渲染" tabindex="-1"><a class="header-anchor" href="#多语言与模板渲染" aria-hidden="true">#</a> 多语言与模板渲染</h2><p>koishi-thirdeye 同样也提供了多语言以及模板渲染支持，在指令的类成员方法中使用装饰器即可使用对应的文本。</p><h3 id="注入渲染器" tabindex="-1"><a class="header-anchor" href="#注入渲染器" aria-hidden="true">#</a> 注入渲染器</h3><p>与传统的 <code>session.text</code> 不同，koishi-thirdeye 的指令回调成员函数中采用渲染器注入的方式，将渲染器函数通过方法参数装饰器注入到指令回调函数参数当中进行调用。</p><h4 id="注入通用渲染器" tabindex="-1"><a class="header-anchor" href="#注入通用渲染器" aria-hidden="true">#</a> 注入通用渲染器</h4><p>您可以使用 <code>@PutCommonRenderer</code> 注入通用渲染器，适合需要渲染不确定的文本的场景。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onFooCommand</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutCommonRenderer</span><span style="color:#F8F8F2;">() </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">CRenderer</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 等价于 session.text(&#39;commands.help.description&#39;)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;commands.help.description&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="注入指定渲染器" tabindex="-1"><a class="header-anchor" href="#注入指定渲染器" aria-hidden="true">#</a> 注入指定渲染器</h4><p><code>@PutRenderer</code> 装饰器可以用来注入某一确定路径的文本的渲染器。特别地，<code>Renderer&lt;T&gt;</code> 的类型参数可以锁定该渲染器的传入参数类型，避免开发时的类型出错。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="文本定义" tabindex="-1"><a class="header-anchor" href="#文本定义" aria-hidden="true">#</a> 文本定义</h3><p>koishi-thirdeye 中，定义文本有下面几种形式：</p><h4 id="分指令完整定义" tabindex="-1"><a class="header-anchor" href="#分指令完整定义" aria-hidden="true">#</a> 分指令完整定义</h4><p>对于代码和文本分离的场景，使用 <code>@CommandLocale(locale: string, def: any)</code> 也是一个好的选择。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;description&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿衣服。&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;options&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;name&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿着的名称。&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;messages&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;notifyWear&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;今天穿 {name} 了吗？&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;zh&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/zh/dress&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// 对应上面的 json 文件。</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">CommandLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;en&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/en/dress&#39;</span><span style="color:#F8F8F2;">)) </span><span style="color:#88846F;">// 略，自行脑补。</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-n &lt;name:string&gt;&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h4 id="完整定义" tabindex="-1"><a class="header-anchor" href="#完整定义" aria-hidden="true">#</a> 完整定义</h4><p>对于需要集中管理文本的情况，我们也可以利用 <code>@DefineLocale</code> 装饰器使用完整定义的方式。</p><p>该装饰器需要放在类的顶部，作用等价于 <code>ctx.i18n.define</code>，形式相同。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;commands.dress&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;description&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿衣服。&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;options&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#66D9EF;font-style:italic;">&quot;name&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;穿着的名称。&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">&quot;messages&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#66D9EF;font-style:italic;">&quot;notifyWear&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;今天穿 {name} 了吗？&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineLocale</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;zh&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;../locales/zh&#39;</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onNotifyDress</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutOption</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;-n &lt;name:string&gt;&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#A6E22E;">PutRenderer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;.notifyWear&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">render</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Renderer</span><span style="color:#F8F8F2;">&lt;{ name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;"> }&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">  ) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">({ name })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="嵌套插件与异步插件" tabindex="-1"><a class="header-anchor" href="#嵌套插件与异步插件" aria-hidden="true">#</a> 嵌套插件与异步插件</h2><p>我们可以使用 <code>@UsePlugin()</code> 装饰器进行注册子插件。在插件加载时方法会自动被调用。该方法需要返回插件定义，可以使用 <code>PluginDef()</code> 方法生成。</p><p>成员方法内返回的插件定义可以是同步也可以是异步的。</p><p>例如我们需要在插件内加载 <code>@koishijs/plugin-common</code> 作为子插件，我们可以用下面的方法。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> PluginCommon </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@koishijs/plugin-common&#39;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { DefinePlugin, BasePlugin, UsePlugin, PluginDef } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">registerPluginCommon</span><span style="color:#F8F8F2;">() { </span><span style="color:#88846F;">// 会于插件注册时立即运行，并取返回值作为插件的嵌套插件</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">PluginDef</span><span style="color:#F8F8F2;">(PluginCommon, { echo: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getPluginCommonConfig</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> { echo: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">registerAsyncPluginCommon</span><span style="color:#F8F8F2;">() { </span><span style="color:#88846F;">// 可以是异步插件</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> pluginCommonConfig </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">getPluginCommonConfig</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">PluginDef</span><span style="color:#F8F8F2;">(PluginCommon, pluginCommonConfig)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="选择器" tabindex="-1"><a class="header-anchor" href="#选择器" aria-hidden="true">#</a> 选择器</h2><p>选择器装饰器可以注册在插件类顶部，也可以注册在插件方法函数。</p><p>插件类顶部定义的上下文选择器是全局的，会影响使用 <code>@Inject</code> 或 <code>@InjectContext</code> 注入的任何上下文对象，以及构造函数中传入的上下文对象。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">OnPlatform</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;onebot&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 类内的 this.context 现在只对 OneBot 平台有效</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">OnGuild</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseEvent</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 只对 OneBot 平台的群组有效</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onMessage</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">session</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Session</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api-4" tabindex="-1"><a class="header-anchor" href="#api-4" aria-hidden="true">#</a> API</h3><ul><li><code>@OnUser(value)</code> 等价于 <code>ctx.user(value)</code>。</li><li><code>@OnSelf(value)</code> 等价于 <code>ctx.self(value)</code>。</li><li><code>@OnGuild(value)</code> 等价于 <code>ctx.guild(value)</code>。</li><li><code>@OnChannel(value)</code> 等价于 <code>ctx.channel(value)</code>。</li><li><code>@OnPlatform(value)</code> 等价于 <code>ctx.platform(value)</code>。</li><li><code>@OnPrivate(value)</code> 等价于 <code>ctx.private(value)</code>。</li><li><code>@OnSelection(value)</code> 等价于 <code>ctx.select(value)</code>。</li></ul><h2 id="条件注册" tabindex="-1"><a class="header-anchor" href="#条件注册" aria-hidden="true">#</a> 条件注册</h2><p>如果某个事件或是子插件只在满足一定条件的情况下进行注册，那么我们可以使用 <code>@If</code> 装饰器来指定。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">If</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;">&gt;((</span><span style="color:#FD971F;font-style:italic;">o</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> o.config.dress) </span><span style="color:#88846F;">// 只有 config.dress 是 true 的情况下该指令才会注册。</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">dressCommand</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;我穿裙子了！&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="api-5" tabindex="-1"><a class="header-anchor" href="#api-5" aria-hidden="true">#</a> API</h3><p><code>@If&lt;T&gt;(o: T, config: Config, ctx: Context)</code></p><ul><li><strong>o:</strong> 插件实例对象。</li><li><strong>config:</strong> 插件的配置。</li><li><strong>ctx:</strong> 插件的上下文对象。</li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>由于装饰器无法自动推断类型，因此为了更好地使用该装饰器，您需要如同上例一般，手动指定装饰器的类型 <code>T</code> 为插件类本身。</p></div><h2 id="声明依赖关系" tabindex="-1"><a class="header-anchor" href="#声明依赖关系" aria-hidden="true">#</a> 声明依赖关系</h2><p>koishi-thirdeye 支持自动管理插件的关系依赖列表。</p><h3 id="全局依赖" tabindex="-1"><a class="header-anchor" href="#全局依赖" aria-hidden="true">#</a> 全局依赖</h3><p>声明全局依赖有下面几种方法。您也可以把下面几种方法组合使用。</p><ul><li>使用 <code>@Inject</code> 装饰器注入服务对象时，将最后一个参数赋值为 <code>true</code>。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span><span style="color:#F8F8F2;"> </span><span style="color:#88846F;">// 注入数据库服务，并声明为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">MyPlugin.using </span><span style="color:#88846F;">// [&#39;database&#39;]</span></span></code></pre><!--]--><!--]--><!--]--></div></div><ul><li>使用 <code>@UsingService()</code> 装饰器。</li></ul><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UsingService</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;assets&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 业务代码</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">MyPlugin.using </span><span style="color:#88846F;">// [&#39;database&#39;, &#39;assets&#39;]</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="部分依赖" tabindex="-1"><a class="header-anchor" href="#部分依赖" aria-hidden="true">#</a> 部分依赖</h3><p>您也可以使用 <code>@UsingService()</code> 装饰器对插件类中某一个方法函数单独声明依赖。这时候该方法注册的注册的中间件、事件监听器、指令等在该类方法绑定的事件只有在该依赖存在时生效。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 该指令仅在数据库被安装时生效</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UsingService</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;database&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;获取自己的裙子信息&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getDresses</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutSession</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;userId&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">userId</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> dresses </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, { userId })</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> dresses.</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">dress</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> dress.name).</span><span style="color:#A6E22E;">join</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="提供服务" tabindex="-1"><a class="header-anchor" href="#提供服务" aria-hidden="true">#</a> 提供服务</h2><p>和 Service 基类不同的是，koishi-thirdeye 使用 <code>@Provide</code> 进行提供服务的声明，提供依赖注入 (DI) 风格的 IoC 的开发方式。</p><p>若该提供者需要立即生效，我们需要使用 <code>immediate</code> 属性，将其标记为立即加载的提供者。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Provide, DefinePlugin, BasePlugin } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 类型合并定义不可省略</span></span>
<span class="line"><span style="color:#F92672;">declare</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">namespace</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Services</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">      myService</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyServicePlugin</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Provide</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;myService&#39;</span><span style="color:#F8F8F2;">, { immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-service&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyServicePlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 该类会作为 Koishi 的 Service 供其他 Koishi 插件进行引用</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><code>@Provide</code> 装饰器中已经提供了完整的服务提供者的逻辑，因此 <code>@Provide</code> 与 Service 基类二者取其一即可。如果您在编写数据库等 Koishi 内置服务的实现，请<strong>不要</strong>使用 <code>@Provide</code> 装饰器。</p></div><h3 id="caller-装饰器" tabindex="-1"><a class="header-anchor" href="#caller-装饰器" aria-hidden="true">#</a> <code>@Caller</code> 装饰器</h3><p>与 Koishi 的 <code>Service</code> 基类的 <code>caller</code> 字段对应，我们可以使用 <code>@Caller</code> 装饰器修饰的成员变量来获取访问该插件的上下文。</p><p>下面是一个例子，确保注册 Photo 的插件卸载时，Photo 正常被删除。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Provide, DefinePlugin, BasePlugin, Caller } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi-thirdeye&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Provide</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;MyPhotoRegistry&#39;</span><span style="color:#F8F8F2;">, { immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-photo-registry&#39;</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPhotoRegistry</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> photos </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">Set</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Photo</span><span style="color:#F8F8F2;">&gt;()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Caller</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> caller</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">addPhoto</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">photo</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Photo</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 预先保存一下正在访问该方法的上下文，预防以后发生变化。</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> ctx </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.caller</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 注册来源插件上下文的卸载监听器，使得来源插件卸载时该 Photo 自动被删除。</span></span>
<span class="line"><span style="color:#F8F8F2;">    ctx.</span><span style="color:#A6E22E;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dispose&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.photos.</span><span style="color:#A6E22E;">delete</span><span style="color:#F8F8F2;">(photo))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.photos.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(photo)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h2 id="多实例插件" tabindex="-1"><a class="header-anchor" href="#多实例插件" aria-hidden="true">#</a> 多实例插件</h2><p>您可能需要开发某一类插件，这些插件的配置中允许定义多个实例，而插件加载时会将每一个对应配置进行实例化，如 <a href="https://npmjs.com/package/koishi-plugin-autopic" target="_blank" rel="noopener noreferrer">autopic<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 插件，会定时向特定目标发送随机图片。这些插件的配置看起来像下面的配置，具有 <code>instances</code> 属性，配置每一个实例，并在插件加载时分别进行实例化。</p><p>我们配置这些插件的时候，会像下面这样书写配置：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;"># koishi.yml</span></span>
<span class="line"><span style="color:#F92672;">plugins</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">autopic</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">instances</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">interval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">30000</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">白丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111111&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">interval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">60000</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">黑丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111112&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>这样的插件通常情况下，会如同下面的方式进行编写：</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">InstanceConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  interval</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: </span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  tags</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: SendTarget })</span></span>
<span class="line"><span style="color:#F8F8F2;">  targets</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">SendTarget</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  instances</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Instance</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Instance</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">ctx</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">config</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">InstanceConfig</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    ctx.</span><span style="color:#A6E22E;">setInterval</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(), config.interval)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 发送图片</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ schema: Config })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">AutoPicPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.instances.</span><span style="color:#A6E22E;">forEach</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">instanceConfig</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Instance</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.ctx, config))</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>更复杂的情况，我们还需要手动实现每个实例的生命周期管理，这会让多实例插件编写变得十分繁琐。因此 koishi-thirdeye 提供了多实例插件的解决方案。</p><h3 id="编写切面" tabindex="-1"><a class="header-anchor" href="#编写切面" aria-hidden="true">#</a> 编写切面</h3><p>使用 koishi-thirdeye 编写多实例插件时，您只需要对切面进行编写。编写切面的方式和编写插件的方式相同。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>切面插件只支持使用 koishi-thirdeye 编写。</p></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;">// instance.ts</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">InstanceConfig</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  cron</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: </span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  tags</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">({ type: SendTarget })</span></span>
<span class="line"><span style="color:#F8F8F2;">  targets</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">SendTarget</span><span style="color:#F8F8F2;">[]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ schema: InstanceConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Instance</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">InstanceConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// 发送图片</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onApply</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.ctx.</span><span style="color:#A6E22E;">setInterval</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(), </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.config.interval)</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="定义多实例插件" tabindex="-1"><a class="header-anchor" href="#定义多实例插件" aria-hidden="true">#</a> 定义多实例插件</h3><p>完成切面编写之后，您只需要使用 <code>MultiInstancePlugin</code> 基类工厂函数，即可定义多实例插件。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>多实例插件的 Schema 描述配置模式已经由 <code>MultiInstancePlugin</code> 自动生成，请不要对其进行覆盖，以避免配置异常。</p></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;">// index.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">AutoPicPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">MultiInstancePlugin</span><span style="color:#F8F8F2;">(AutoPicInstancePlugin) {}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>加载多实例插件时，每个实例的配置均在配置的 <code>instances</code> 属性下，对应切面插件的配置项。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;"># koishi.yml</span></span>
<span class="line"><span style="color:#F92672;">plugins</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">autopic</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">instances</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">interval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">30000</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">白丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111111&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">interval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">60000</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">黑丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111112&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>此外，<code>MultiInstancePlugin</code> 接受 Schema 描述配置模式类作为第二个参数，允许您对插件的配置进行注入。</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>注入的描述配置模式类只支持使用 <a href="/community/decorator/schemastery.html" class="">schemastery-gen</a>，即装饰器的形式，进行编写。</p></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;">// index.ts</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">RegisterSchema</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Config</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">SchemaProperty</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  defaultInterval</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">AutoPicPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">MultiInstancePlugin</span><span style="color:#F8F8F2;">(AutoPicInstancePlugin, Config) {}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#88846F;"># koishi.yml</span></span>
<span class="line"><span style="color:#F92672;">plugins</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">autopic</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">defaultInterval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">30000</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">instances</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">白丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111111&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">      - </span><span style="color:#F92672;">interval</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">60000</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">tags</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#E6DB74;">黑丝</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">targets</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">          - </span><span style="color:#F92672;">bot</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;onebot:1111111112&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">channels</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">              - </span><span style="color:#F92672;">channelId</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&#39;123123123&#39;</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="实例管理" tabindex="-1"><a class="header-anchor" href="#实例管理" aria-hidden="true">#</a> 实例管理</h3><p>多实例插件基类提供了 <code>instances</code> 属性，可以访问所有加载的实例。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">AutoPicPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">MultiInstancePlugin</span><span style="color:#F8F8F2;">(AutoPicInstancePlugin) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;instance &lt;name&gt;&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;获取实例状态&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">onGetInstanceStatus</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> instance </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.instances.</span><span style="color:#A6E22E;">find</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">instance</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> instance.name </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> name)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (</span><span style="color:#F92672;">!</span><span style="color:#F8F8F2;">instance) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;未找到实例。&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> instance.</span><span style="color:#A6E22E;">getStatus</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><p>要在切面插件中访问其父插件，可以使用<a href="#%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1">服务</a>的形式。</p><h2 id="扩展数据表" tabindex="-1"><a class="header-anchor" href="#扩展数据表" aria-hidden="true">#</a> 扩展数据表</h2><p>借助 koishi-entities 这个包，您也可以很轻松地使用类和装饰器定义数据表。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>koishi-thirdeye 已经重新导出了这个包，无需再手动导入或安装 koishi-entities。</p></div><h3 id="定义数据表" tabindex="-1"><a class="header-anchor" href="#定义数据表" aria-hidden="true">#</a> 定义数据表</h3><p>数据表类以 <code>@DefineModel</code> 装饰器进行修饰，指明表的名称。同时，每个表字段以 <code>@ModelField()</code> 装饰器进行修饰。</p><p><code>@ModelField</code> 的第一个参数用于指定表的类型，用法见 <a href="/community/database/#%E6%89%A9%E5%B1%95%E5%AD%97%E6%AE%B5" class=""><code>ctx.model</code></a> 的用法。同时，您也可以使用一些其他的相关装饰器自定义表的相关行为。</p><p>在数据库查询时，结果中的对象均会被类实例化。因此您可以在类中灵活地定义方法函数，简化数据对象的操作。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefineModel</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 表名称</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">PrimaryGenerated</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 自增主键</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(11)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  id</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Unique</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 唯一键</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  name</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">(</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.id</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">)`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Foreign</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#88846F;">// 外键，指向 dress.id</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(11)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  parentId</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="注册数据表模型" tabindex="-1"><a class="header-anchor" href="#注册数据表模型" aria-hidden="true">#</a> 注册数据表模型</h3><p>您只需要使用 <code>@UseModel</code> 装饰器修饰插件类即可。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">UseModel</span><span style="color:#F8F8F2;">(Dress) </span><span style="color:#88846F;">// 注册 Dress 数据表模型</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// 注入数据库服务，并注册为依赖</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">private</span><span style="color:#F8F8F2;"> database</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">DatabaseService</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;dress &lt;id&gt;&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">getDress</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutArg</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">id</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">number</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> [dress] </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.database.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(dress, { id })</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (dress) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> dress.</span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() </span><span style="color:#88846F;">// 可以使用对象方法</span></span>
<span class="line"><span style="color:#F8F8F2;">    } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;Not found.&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><h3 id="扩展内置数据表" tabindex="-1"><a class="header-anchor" href="#扩展内置数据表" aria-hidden="true">#</a> 扩展内置数据表</h3><p>对于 <code>user</code> 或 <code>channel</code> 等内置数据表，以及来自其他插件的表，比起重新定义整个表模型，更常见的场景是需要在表内添加若干字段。这种情况下 <code>@MixinModel</code> 可能为适合。</p><div class="panel-view mini code" style=""><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><!----><!----></div></div><div class="content"><!--[--><!--[--><!--[--><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">declare</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">module</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;koishi&#39;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">interface</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    dress</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// 无需 @DefineModel 装饰器</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">Dress</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;string(8)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  color</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">ModelField</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;integer(7)&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  size</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">string</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.color</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> dress of size </span><span style="color:#F92672;">${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.id</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">MixinModel</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;user&#39;</span><span style="color:#F8F8F2;">, { dress: Dress }) </span><span style="color:#88846F;">// 将 Dress 类成员字段作为 dress 属性注入到 user 表中</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">DefinePlugin</span><span style="color:#F8F8F2;">({ name: </span><span style="color:#E6DB74;">&#39;my-plugin&#39;</span><span style="color:#F8F8F2;">, schema: MyPluginConfig })</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">MyPlugin</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">BasePlugin</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">MyPluginConfig</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  @</span><span style="color:#A6E22E;">UseCommand</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mydress&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">getDress</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">PutUser</span><span style="color:#F8F8F2;">([</span><span style="color:#E6DB74;">&#39;name&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;dress&#39;</span><span style="color:#F8F8F2;">]) </span><span style="color:#FD971F;font-style:italic;">user</span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">`</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">user.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> is wearing a </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">user.dress.</span><span style="color:#A6E22E;">getDisplayString</span><span style="color:#F8F8F2;">()</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">.`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><!--]--><!--]--><!--]--></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/koishijs/koishi/edit/main/docs/community/decorator/thirdeye.md" rel="noopener noreferrer" target="_blank" aria-label="帮助我们改善此页面"><!--[--><!--]--> 帮助我们改善此页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/community/decorator/schemastery.html" class="" aria-label="描述配置模式"><!--[--><!--]--> 描述配置模式 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.7e6eba9e.js" defer></script>
  </body>
</html>
